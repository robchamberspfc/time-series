<html lang="en">

	<head>

		<title>Office for National Statistics</title>
		<script src="https://code.highcharts.com/highcharts.js"></script>
		<script src="https://code.highcharts.com/modules/data.js"></script>
		<script src="https://code.highcharts.com/modules/exporting.js"></script>
		<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
		<!--[if lte IE 8]> <link rel="stylesheet" type="text/css" href="https://onsdigital.github.io/ons-pattern-library-starter/sixteens/css/old-ie.css"> <![endif]-->
		<!--[if IE 9]> <link rel="stylesheet" type="text/css" href="https://onsdigital.github.io/ons-pattern-library-starter/sixteens/css/ie-9.css"> <![endif]-->
		<!--[if gt IE 9]><!-->
		<link rel="stylesheet" type="text/css" href="https://cdn.ons.gov.uk/sixteens/1f354a7/css/main.css">
		<meta content="width=device-width,initial-scale=1.0,user-scalable=1" name="viewport">
		<![endif]-->

	</head>

	<body>
		<nav>
			<div class="wrapper">
				<div class="header col-wrap">
					<div class="col col--lg-one-third col--md-one-third">
						<a href="https://github.com/robchamberspfc">
							<img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Vitruvian_Man_Noun_project_6674.svg/1000px-Vitruvian_Man_Noun_project_6674.svg.png" alt="Office for National Statistics">
						</a>
					</div>
					<div class="col col--lg-two-thirds col--md-two-thirds print--hide">&nbsp;</div>
					<nav class="secondary-nav col col--lg-two-thirds col--md-two-thirds print--hide">
						<ul class="secondary-nav__list js-nav-clone__list">
							<li class="secondary-nav__item">
								<a class="secondary-nav__link  js-nav-clone__link" href="https://www.ons.gov.uk/releasecalendar">Release calendar</a>
							</li>
							<li class="secondary-nav__item">
								<a class="secondary-nav__link  js-nav-clone__link" href="https://www.ons.gov.uk/methodology">Methodology</a>
							</li>
							<li class="secondary-nav__item">
								<a class="secondary-nav__link  js-nav-clone__link" href="https://www.ons.gov.uk/news">Media</a>
							</li>
							<li class="secondary-nav__item">
								<a class="secondary-nav__link  js-nav-clone__link" href="https://www.ons.gov.uk/aboutus">About</a>
							</li>
							<li class="secondary-nav__item">
								<a class="secondary-nav__link js-nav-clone__link" rel="noopener noreferrer" href="https://blog.ons.gov.uk/">Blog</a>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</nav>
		<div class="primary-nav print--hide">
			<nav>
				<ul class="nav--controls">
					<li class="nav--controls__item">
						<a href="#nav-primary" id="menu-toggle" aria-controls="nav-primary" class="nav--controls__menu">
							<span class="nav--controls__text">Menu</span>
						</a>
					</li>
					<li class="nav--controls__item ">
						<a href="#nav-search" id="search-toggle" aria-controls="nav-search" class="nav--controls__search">
							<span class="nav--controls__text">Search</span>
						</a>
					</li>
				</ul>
				<div class="wrapper nav-main--hidden" id="nav-primary" aria-expanded="false">
					<ul class="primary-nav__list">
						<li class="primary-nav__item  js-nav hide--sm old-ie--display-block">
							<a class="primary-nav__link col col--md-7 col--lg-9" href="https://www.ons.gov.uk/">Home</a>
						</li>
						<li class="primary-nav__item js-nav js-expandable primary-nav__item--active">
							<a class="primary-nav__link col col--md-8 col--lg-10" href="https://www.ons.gov.uk/businessindustryandtrade" aria-haspopup="true">Business, industry and trade</a>
							<ul class="primary-nav__child-list col col--md-16 col--lg-20 js-expandable__content js-nav-hidden jsEnhance" aria-expanded="false" aria-label="submenu">
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/business">Business</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/changestobusiness">Changes to business</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/constructionindustry">Construction industry</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/itandinternetindustry">IT and internet industry</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/internationaltrade">International trade</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/manufacturingandproductionindustry">Manufacturing and production industry</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/retailindustry">Retail industry</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/businessindustryandtrade/tourismindustry">Tourism industry</a>
								</li>
							</ul>
						</li>
						<li class="primary-nav__item js-nav js-expandable">
							<a class="primary-nav__link col col--md-8 col--lg-10" href="https://www.ons.gov.uk/economy" aria-haspopup="true">Economy</a>
							<ul class="primary-nav__child-list col col--md-16 col--lg-20 js-expandable__content js-nav-hidden jsEnhance" aria-expanded="false" aria-label="submenu">
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/economicoutputandproductivity">Economic output and productivity</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/environmentalaccounts">Environmental accounts</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/governmentpublicsectorandtaxes">Government, public sector and taxes</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/grossdomesticproductgdp">Gross Domestic Product (GDP)</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/grossvalueaddedgva">Gross Value Added (GVA)</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/inflationandpriceindices">Inflation and price indices</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/investmentspensionsandtrusts">Investments, pensions and trusts</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/nationalaccounts">National accounts</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/economy/regionalaccounts">Regional accounts</a>
								</li>
							</ul>
						</li>
						<li class="primary-nav__item js-nav js-expandable">
							<a class="primary-nav__link col col--md-8 col--lg-10" href="https://www.ons.gov.uk/employmentandlabourmarket" aria-haspopup="true">Employment and labour market</a>
							<ul class="primary-nav__child-list col col--md-16 col--lg-20 js-expandable__content js-nav-hidden jsEnhance" aria-expanded="false" aria-label="submenu">
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork">People in work</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/employmentandlabourmarket/peoplenotinwork">People not in work</a>
								</li>
							</ul>
						</li>
						<li class="primary-nav__item js-nav js-expandable">
							<a class="primary-nav__link col col--md-8 col--lg-10" href="https://www.ons.gov.uk/peoplepopulationandcommunity" aria-haspopup="true">People, population and community</a>
							<ul class="primary-nav__child-list col col--md-16 col--lg-20 js-expandable__content js-nav-hidden jsEnhance" aria-expanded="false" aria-label="submenu">
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages">Births, deaths and marriages</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice">Crime and justice</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/culturalidentity">Cultural identity</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/educationandchildcare">Education and childcare</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/elections">Elections</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare">Health and social care</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/householdcharacteristics">Household characteristics</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/housing">Housing</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/leisureandtourism">Leisure and tourism</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/personalandhouseholdfinances">Personal and household finances</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration">Population and migration</a>
								</li>
								<li class="primary-nav__child-item  js-expandable__child">
									<a class="primary-nav__child-link" tabindex="-1" href="https://www.ons.gov.uk/peoplepopulationandcommunity/wellbeing">Well-being</a>
								</li>
							</ul>
						</li>
						<li class="primary-nav__item  js-nav">
							<a class="primary-nav__link  col col--md-8 col--lg-10" href="https://www.ons.gov.uk/surveys">
								Taking part in a survey?
							</a>
						</li>
					</ul>
				</div>
			</nav>
		</div>
		<div class="search nav-search--hidden print--hide" id="searchBar">
			<div class="wrapper" role="search">
				<form class="col-wrap search__form" action="https://www.ons.gov.uk/search">
					<label class="search__label col col--md-23 col--lg-24" for="nav-search">
						Search for a keyword(s) or time series ID
					</label>
					<input type="search" autocomplete="off" class="search__input col col--md-21 col--lg-32" id="nav-search" name="q" value="">
					<button type="submit" class="search__button col--md-3 col--lg-3" id="nav-search-submit">
						<span class="visuallyhidden">Search</span>
						<span class="icon icon-search--light"></span>
					</button>
				</form>
			</div>
		</div>

		<div class="wrapper">
			Blank? Dont forget some parameters!
			<div id="charts">
			</div>

		</div>

		<footer class="print--hide">
			<h2 class="visuallyhidden">Footer links</h2>
			<div class="footer">
				<div class="wrapper">
					<div class="footer-license">
						<img class="footer-license__img" alt="OGL" width="60" src="https://www.ons.gov.uk/img/ogl.png">
						<p class="footer-license__text margin-left-sm--0">
							All content is available under the
							<a class="icon--hide" href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence v3.0</a>, except where otherwise stated
						</p>
					</div>
				</div>
			</div>
		</footer>

		<script>

			var api = "https://api.ons.gov.uk/timeseries/"
			var website = "https://www.ons.gov.uk"
			const ts = document.getElementById('timeSeriesData');
			const charts = document.getElementById('charts');
			const tsdm = document.getElementById('timeSeriesDataMonths');
			const tsdq = document.getElementById('timeSeriesDataQuarters');
			const tsdy = document.getElementById('timeSeriesDataYears');

			function createNode(element) {
				return document.createElement(element); // Create the type of element you pass in the parameters
			}

			function append(parent, el) {
				return parent.appendChild(el); // Append the second parameter(element) to the first one
			}

			document.addEventListener("DOMContentLoaded", function () {
				// Handler when the DOM is fully loaded
				getAllUrlParams()
			});

			function getAllUrlParams(url) {

				// get query string from url (optional) or window
				var queryString = url
					? url.split('?')[1]
					: window.location.search.slice(1);

				// we'll store the parameters here
				var obj = {};

				// if query string exists
				if (queryString) {
					// stuff after # is not part of query string, so get rid of it
					queryString = queryString.split('#')[0];

					// split our query string into its component parts
					var arr = queryString.split('&');

					for (var i = 0; i < arr.length; i++) {
						// separate the keys and the values
						var a = arr[i].split('=');

						// in case params look like: list[]=thing1&list[]=thing2
						var paramNum = undefined;
						var paramName = a[0].replace(/\[\d*\]/, function (v) {
							paramNum = v.slice(1, -1);
							return '';
						});

						// set parameter value (use 'true' if empty)
						var paramValue = typeof(a[1]) === 'undefined'
							? true
							: a[1];

						// (optional) keep case consistent
						paramName = paramName.toLowerCase();
						paramValue = paramValue.toLowerCase();

						//console.log (paramValue) if parameter name already exists
						if (obj[paramName]) {
							// convert value to array (if still string)
							if (typeof obj[paramName] === 'string') {
								obj[paramName] = [obj[paramName]];
							}
							// if no array index number specified...
							if (typeof paramNum === 'undefined') {
								// put the value on the end of the array
								obj[paramName].push(paramValue // if array index number specified...
								);
							} else {
								// put the value at that index number
								obj[paramName][paramNum] = paramValue // if param name doesn't exist yet, set it;
							}
						} else {
							obj[paramName] = paramValue;
						}
					}
				}
				for (var i = 0; i < obj.id.length; i++) {
					fetch(api + obj.id[i], {mode: 'cors'}).then(data => data.json()).then(function (data) {

						let variations = data.items;
						let getLatest = data.totalItems;

						if (getLatest > 1) {
							//console.log(getLatest)
							variations.map(function (variations, index) {
								//console.log(index)
								if (index == 0) {
									let uriFirst = variations.uri;
									let stripDataset = uriFirst.substr(0, uriFirst.lastIndexOf("/"));
									var latestUri = website + stripDataset + "/data"

									blocks(data, latestUri)

								}
							})
						} else {

							variations.map(function (variations) {
								let uri = variations.uri;
								let stripDataset = uri.substr(0, uri.lastIndexOf("/"));
								var latestUri = website + stripDataset + "/data"

								blocks(data, latestUri)

							})
						}
					});
				}

				return obj;

			}


			function blocks (data, latestUri) {
				fetch(latestUri, {mode: 'cors'}).then(data => data.json()).then(function (data) {
					let divcol = createNode('div');
					let div = createNode('div');
					let div2 = createNode('div');
					let timeSeriesData = data.description;
					div.innerHTML = timeSeriesData.title;
					div2.innerHTML = timeSeriesData.releaseDate;
					charts.appendChild(divcol)
					divcol.classList.add("col-wrap");
					divcol.appendChild(div)
					div.classList.add("col");
					div.classList.add("col--md-full");
					div.classList.add("col--lg-full");
					div.appendChild(div2)
					div2.classList.add("col");
					div2.classList.add("col--md-one-third");
					div2.classList.add("col--lg-one-third");
					div2.innerHTML = "<div id='Months'></div><div id='Quarters'></div><div id='Years'></div>"
					let timeSeriesDataMonths = data.months;
					let timeSeriesDataQuarters = data.quarters;
					let timeSeriesDataYears = data.years;
					if (data.months.length > 0) {
						block = "Months"
						dataArrayMonths = []
						eval("timeSeriesData" + block).map(function (data) {
							date = data.date
							value = data.value
							chartdata = [date, parseFloat(value)]
							eval("dataArray" + block).push(chartdata)
						})
						chart (timeSeriesData, block)
					}
					if (data.quarters.length > 0) {
						block = "Quarters"
						dataArrayQuarters = []
						eval("timeSeriesData" + block).map(function (data) {
							date = data.date
							value = data.value
							chartdata = [date, parseFloat(value)]
							eval("dataArray" + block).push(chartdata)
						})
						chart (timeSeriesData, block)
					}
					if (data.years.length > 0) {
						block = "Years"
						dataArrayYears = []
						eval("timeSeriesData" + block).map(function (data) {
							date = data.date
							value = data.value
							chartdata = [date, parseFloat(value)]
							eval("dataArray" + block).push(chartdata)
						})
						chart (timeSeriesData, block)
					}
				})

			}


			function chart (timeSeriesData, block) {
				Highcharts.chart( block , {
				series: [
					{
						data: eval("dataArray" + block),
						name: timeSeriesData.cdid + ": " + block
					}
				],
				title: {
					text: timeSeriesData.cdid + ": " + block + " (Dataset: " + timeSeriesData.datasetId + ")"
				},
				navigation: {
					buttonOptions: {
						enabled: false
					}
				},
				yAxis: {
					labels: {
						enabled: false
					},
					title: {
						enabled: false
					}
				},
				legend: {
					enabled: false
				},
				tooltip: {
					formatter: function () {
						return '<b>' + this.key + '</b><br>' + timeSeriesData.preUnit + this.y + ' ' + timeSeriesData.unit + '';
					},
				},
				xAxis: {
					type: "category",
					crosshair: true
				},
				credits: {
					enabled: false
				}
			});
		}


		</script>

	</body>
</html>
